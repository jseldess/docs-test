"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2011],{1402:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var a=r(5893),s=r(1151);const i={title:"Query data",category:"6495c32609a24b00434e5b53"},t=void 0,o={id:"data/query-data",title:"Query data",description:"After your data is indexed, you can start sending queries to Pinecone.",source:"@site/versioned_docs/version-legacy/data/query-data.md",sourceDirName:"data",slug:"/data/query-data",permalink:"/docs/legacy/data/query-data",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/versioned_docs/version-legacy/data/query-data.md",tags:[],version:"legacy",frontMatter:{title:"Query data",category:"6495c32609a24b00434e5b53"},sidebar:"examplesSidebar",previous:{title:"Filtering with metadata",permalink:"/docs/legacy/data/metadata-filtering"}},c={},d=[{value:"Sending a query",id:"sending-a-query",level:2},{value:"Querying by namespace",id:"querying-by-namespace",level:2},{value:"Using metadata filters in queries",id:"using-metadata-filters-in-queries",level:2},{value:"Querying vectors with sparse and dense values",id:"querying-vectors-with-sparse-and-dense-values",level:2},{value:"Limitations",id:"limitations",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,s.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["After your data is ",(0,a.jsx)(n.a,{href:"insert-data",children:"indexed"}),", you can start sending queries to Pinecone."]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"Query"})," operation searches the index using a query vector. It retrieves the IDs of the most similar records in the index, along with their similarity scores. This operation can optionally return the result's vector values and metadata, too. You specify the number of vectors to retrieve each time you send a query. Matches are always ordered by similarity from most similar to least similar."]}),"\n",(0,a.jsxs)(n.p,{children:["The similarity score for a vector represents its distance to the query vector, calculated according to the ",(0,a.jsx)(n.a,{href:"indexes#distance-metrics",children:"distance metric"})," for the index. The significance of the score depends on the similarity metric. For example, for indexes using the ",(0,a.jsx)(n.code,{children:"euclidean"})," distance metric, scores with lower values are more similar, while for indexes using the ",(0,a.jsx)(n.code,{children:"dotproduct"})," metric, higher scores are more similar."]}),"\n",(0,a.jsx)(n.h2,{id:"sending-a-query",children:"Sending a query"}),"\n",(0,a.jsxs)(n.p,{children:["When you send a query, you provide vector values representing your query embedding. The ",(0,a.jsx)(n.code,{children:"top_k"})," parameter indicates the number of results to return. For example, this example sends a query vector and retrieves three matching vectors:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import pinecone\n\npinecone.init(api_key="YOUR_API_KEY", environment="YOUR_ENVIRONMENT")\nindex = pinecone.Index(\'example-index\')\n\nindex.query(\n  vector=[0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3],\n  top_k=3,\n  include_values=True\n)\n# Returns:\n# {\n#     "matches": [\n#         {\n#             "id": "C",\n#             "score": -1.76717265e-07,\n#             "values": [0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3],\n#         },\n#         {\n#             "id": "B",\n#             "score": 0.080000028,\n#             "values": [0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2],\n#         },\n#         {\n#             "id": "D",\n#             "score": 0.0800001323,\n#             "values": [0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4],\n#         },\n#     ],\n#     "namespace": "",\n# }\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"import { Pinecone } from '@pinecone-database/pinecone'\n\nconst pinecone = new Pinecone({\n  apiKey: \"YOUR_API_KEY\",\n  environment: \"YOUR_ENVIRONMENT\"\n})\nconst index = pinecone.index(\"example-index\");\n\nconst queryResponse = await index.query({\n    vector: [0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3],\n    topK: 3,\n    includeValues: true,\n});\n// Returns:\n// { \n//   matches: [\n//             { \n//               id: 'C',\n//               score: 0.000072891,\n//               values: [0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3]\n//             },\n//             {\n//               id: 'B',\n//               score: 0.080000028,\n//               values: [0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2]\n//             },\n//             {\n//               id: 'D',\n//               score: 0.0800001323,\n//               values: [0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4, 0.4]\n//             }\n//           ],\n//   namespace: ''\n// }\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",metastring:"curl",children:"INDEX_NAME='index-name' \\\nPROJECT='project-id' \\\nENVIRONMENT='your-environment' \\\nAPI_KEY='your-api-key' \\\n  curl -i -X POST \"https://$INDEX_NAME-$PROJECT.svc.$ENVIRONMENT.pinecone.io/query\" \\\n    -H \"Api-Key: $API_KEY\" \\\n    -H 'Content-Type: application/json' \\\n    -d '{\n      \"vector\":[0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3, 0.3],\n      \"topK\": 3,\n      \"includeValues\": true\n    }'\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Depending on your data and your query, you may get fewer than ",(0,a.jsx)(n.code,{children:"top_k"})," results. This happens when ",(0,a.jsx)(n.code,{children:"top_k"})," is larger than the number of possible matching vectors for your query."]}),"\n",(0,a.jsx)(n.h2,{id:"querying-by-namespace",children:"Querying by namespace"}),"\n",(0,a.jsxs)(n.p,{children:['You can organize the records added to an index into partitions, or "namespaces," to limit queries and other vector operations to only one such namespace at a time. For more information, see: ',(0,a.jsx)(n.a,{href:"namespaces",children:"Namespaces"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"using-metadata-filters-in-queries",children:"Using metadata filters in queries"}),"\n",(0,a.jsxs)(n.p,{children:["You can add metadata to document embeddings within Pinecone, and then filter for those criteria when sending the query. Pinecone will search for similar vector embeddings only among those items that match the filter. For more information, see: ",(0,a.jsx)(n.a,{href:"metadata-filtering",children:"Metadata Filtering"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'index.query(\n    vector=[0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1],\n    filter={\n        "genre": {"$eq": "documentary"},\n        "year": 2019\n    },\n    top_k=1,\n    include_metadata=True\n)\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:'const index = pinecone.index(\'example-index\');\nconst queryResponse = await index.query({\n    vector: [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1],\n    topK: 1,\n    includeMetadata: true,\n    filter: {\n      "genre": {"$eq": "documentary"}\n    }\n});\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",metastring:"curl",children:'INDEX_NAME=\'index-name\' \\\nPROJECT=\'project-id\' \\\nENVIRONMENT=\'your-environment\' \\\nAPI_KEY=\'your-api-key\' \\\n  curl -i -X POST "https://$INDEX_NAME-$PROJECT.svc.$ENVIRONMENT.pinecone.io/query" \\\n    -H "Api-Key: $API_KEY" \\\n    -H \'Content-Type: application/json\' \\\n    -d \'{\n      "vector": [0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1],\n      "filter": {"genre": {"$in": ["comedy", "documentary", "drama"]}},\n      "topK": 1,\n      "includeMetadata": true\n    }\'\n'})}),"\n",(0,a.jsx)(n.h2,{id:"querying-vectors-with-sparse-and-dense-values",children:"Querying vectors with sparse and dense values"}),"\n",(0,a.jsxs)(n.p,{children:["When querying an index containing ",(0,a.jsx)(n.a,{href:"hybrid-search",children:"sparse and dense vectors"}),", include a ",(0,a.jsx)(n.code,{children:"sparse_vector"})," in your query parameters."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Examples"})}),"\n",(0,a.jsx)(n.p,{children:"The following example shows how to query with a sparse-dense vector."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"query_response = index.query(\n    namespace=\"example-namespace\",\n    top_k=10,\n    vector=[0.1, 0.2, 0.3, 0.4],\n    sparse_vector={\n        'indices': [3],\n        'values':  [0.8]\n    }\n)\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-js",children:"const queryResponse = await index.namespace('example-namespace').query({\n  topK: 10,\n  vector: [0.1, 0.2, 0.3, 0.4],\n  sparseVector: {\n    indices: [3]\n    values: [0.8]\n  }\n})\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",metastring:"curl",children:'INDEX_NAME=\'index-name\' \\\nPROJECT=\'project-id\' \\\nENVIRONMENT=\'your-environment\' \\\nAPI_KEY=\'your-api-key\' \\\n  curl -i -X POST "https://$INDEX_NAME-$PROJECT.svc.$ENVIRONMENT.pinecone.io/query" \\\n    -H "Api-Key: $API_KEY" \\\n    -H \'Accept: application/json\' \\\n    -H \'Content-Type: application/json\' \\\n    -d \'{\n      "includeValues": "false",\n      "includeMetadata": "false",\n      "vector": [\n          0.1,\n          0.2,\n          0.3,\n          0.4\n      ],\n      "sparseVector": {\n          "indices": [ 0 ],\n          "values": [ 0.8 ]\n      },\n      "topK": 10,\n      "namespace": "example-namespace"\n    }\'\n'})}),"\n",(0,a.jsxs)(n.p,{children:["To learn more, see ",(0,a.jsx)(n.a,{href:"query-sparse-dense-vectors",children:"Querying sparse-dense vectors"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,a.jsxs)(n.p,{children:["Avoid returning vector data and metadata when ",(0,a.jsx)(n.code,{children:"top_k"})," is greater than 1000. This means queries with ",(0,a.jsx)(n.code,{children:"top_k"})," over 1000 should not contain ",(0,a.jsx)(n.code,{children:"include_metadata=True"})," or ",(0,a.jsx)(n.code,{children:"include_data=True"}),". For more limitations, see: ",(0,a.jsx)(n.a,{href:"limits",children:"Limits"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Pinecone is eventually consistent, so queries may not reflect very recent upserts."})]})}function u(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},1151:(e,n,r)=>{r.d(n,{Z:()=>o,a:()=>t});var a=r(7294);const s={},i=a.createContext(s);function t(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);